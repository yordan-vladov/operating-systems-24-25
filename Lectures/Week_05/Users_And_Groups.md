# Linux - Потребители и Групи

---
## Съдържание

- Какво са потребители и групи?
- "root" и "sudo"
- Работа с потребители и групи

---
## Потребител

- Индивид или субект, който използва операционната система по някакъв начин, често изпълнявайки различни задачи.
- Потребителите позволяват контрол върху ресурсите и увеличена сигурност

---

## Видове потребители

- **Системни** - създадени от ОС за извършване на системни функции.
- **Обикновени** - създават се от администратор. Могат да използват системата на база техните разрешения.

---
## Група

- Позволяват разпределянето на системни ресурси между множество потребители.
- Опростяват даването на разрешения

---
## root

- **суперпотребител** - има неограничен достъп до всички файлове, директории, конфигурации
- може да използва всяка команда, включително инсталиране на софтуер, системна конфигурация, модифициране на критични файлове

---
- Използването на системата като **root** е лоша идея заради:
    - Сигурност
    - Проследимост
    - Стабилност

---
## root - Сигурност

- **root** потребителя може да бъде мишена за хакерски атаки, понеже има неограничен достъп до системата

---
## root - Проследимост

- Ако няколко администратора използват **root**, може да  е трудно да се проследи кой администратор какво е направил

---
## root - Стабилност

- Понеже **root** може да модифицира критични файлове, всяка грешка може да направи системата неизползваема

---
## sudo

- Позволява на потребителя да изпълни команда с повишени привилегии
- По-сигурен начин потребителите да изпълняват административни задачи

---

## sudo - Примери

- Изтегляне на софтуер чрез пакетният мениджър

```bash
$ sudo apt install package_name
```

---

- Отваряне на файл с чувствителни данни

```bash
cat /etc/shadow
cat: /etc/shadow: Permission denied
sudo cat /etc/shadow
[sudo] password for user:
root:!::0:99999:7:::
...
```
---
- Променяне на системни файлове

```bash
sudo nano /etc/passwd
```
---
## Потребител - Атрибути

- **Username** - името на потребителя
- **User ID** и **Group ID** - цели числа, които идентифицират потребителя и главната му група
- **Home Directory** - директорията, където потребителят пази личните файлове и настройки

---

- **Default Shell** - командният интерпретатор, който потребителят ползва, когато влезе в системата
- **Groups** - групите, към които принадлежи

---

## /etc/passwd

- Съдържа информация за потребителите в системата
- Пример:

```bash
john:x:1002:1002:,,,:/home/john:/bin/bash
```

---

![](/Attachments/OS_Users_And_Groups_Pic_1.png)

---
## /etc/shadow

- В "/etc/passwd" паролите са маркирани като "x"
- Истинските им стойности се пазят в "/etc/shadow" в хеширан формат

```bash
user:$6$YTJ7JKnfsB4esnbS$5XvmYk2.GXVWhDo2TYGN2hCitD/wU9Kov.uZD8xsnleuf1r0ARX3qodIKiDsdoQA444b8IMPMOnUWDmVJVkeg1:19446:0:99999:7:::
```

---
## Принцип на най-малка привилегия

- Потребител има достъп само до минималните ресурси, които са нужни да си върши задачите

---
## Добавяне на потребители

- Използваме командата "useradd"

```bash
useradd <user>
```

---

## useradd - Опции

- "-d \<home_dir>" -  home директория
- "-s \<shell>" - шела на този потребител
- "-e \<date>" - дата на изтичане
- "-f \<inactive>" - брой дни преди изтичане

---

## useradd - Пример

```bash
useradd -d /home/john -s /bin/bash john
```

---
## id

- Дата информация за даден потребител

```bash
id example_user
uid=1000(example_user) gid=1001(example_group) groups=1001(example_group),27(sudo)
```

---
## passwd

- Задаваме парола за даден потребител

```bash
passwd john
```

---
## Създаване на група

- Използваме командата "groupadd"

```bash
groupadd example_group
```

---
## Главна група (Primary Group)

- Всеки потребител принадлежи към точно една главна група
- Може да се види в "/etc/passwd" или чрез "id"
---
## Вторична група (Secondary Group)

- Други групи, към които потребителят може да бъде добавен
- Потребител може да има най-много 15 вторични групи

---
## /etc/group

- Показва информация за групите, като включва
    - **име**
    - **парола**
    - **GID**
    - членове
---
## /etc/group - Пример

```
wheel:x:10:stamat
```

---
## groups

- Показва групите на даден потребител

```bash
groups stamat
stamat : stamat wheel docker
```

---
## Добавяне на потребител към група

- Използваме командата "usermod"

```
usermod -a -G example_group example_user
```

---
## Премахване на потребител от група

```bash
sudo gpasswd -d username groupname
```

---

## Даване на sudo привилегии

1. Добавяне към **sudo** групата
2. Конфигуриране чрез **visudo** командата

---

## Добавяне към sudo група

- Използваме `usermod`

```bash
sudo usermod -aG sudo username
```

---
## visudo

- Позволява ни по-лесно да дефинираме потребителските привилегии, като командата редактира файла "/etc/sudoers"

```bash
sudo visudo
```

---

- Когато работим с директории, можем да добавим "-r", за да приложим промяната и за съдържанието на директорията

---
## Премахване на потребители и групи

```bash
userdel -r username
groupdel groupname
```
