# Управление на услуги с Docker

## Какво е Docker и защо е важен?

Docker е платформа, която ви позволява да изолирате вашето приложение и неговите зависимости в контейнер. Всеки контейнер е изолиран от другите и работи на една и съща хост система, но с различна конфигурация и зависимости.

### Какво означава контейнеризация?

Контейнеризацията представлява процес на опаковане на софтуер в контейнери, които съдържат всичко необходимо за изпълнението му (операционна система, библиотеки, зависимости и др.). Това дава възможност да се изпълняват приложения в различни среди без да има нужда от инсталация на специфични версии на зависимости на хост системата.

### Основни предимства на Docker:

- Преносимост: Контейнерите могат да работят навсякъде (локално, на сървър или в облака), без значение каква операционна система или хостинг е използван.
- Изолация: Всяко приложение работи в изолирана среда и не се влияе от другите приложения.
- Лесно обновление и разширяване: Docker прави лесно създаването, обновяването и разширяването на приложенията чрез използването на малки, преносими контейнери.

## Инсталиране на Docker на Linux

Инсталирането на Docker на Linux е лесен процес, но зависи от конкретната дистрибуция, която използвате. За примера, ще използваме **Ubuntu**.

### Стъпка 1: Актуализиране на системата

Първо, актуализирайте всички пакети, за да сте сигурни, че системата е в актуално състояние.

```bash
sudo apt update
```

### Стъпка 2: Инсталиране на необходими зависимости

След това инсталирайте необходимите пакети, които ще позволят на вашата система да получи пакетите от Docker репозитория.

```bash
sudo apt install apt-transport-https ca-certificates curl software-properties-common
```

- **apt-transport-https** – необходим за да може системата да изтегля пакети през HTTPS.
- **ca-certificates** – инсталира сертификати за сигурност.
- **curl** – инструмент за работа с URL адреси.
- **software-properties-common** – пакет, който съдържа командата add-apt-repository.

### Стъпка 3: Добавяне на Docker хранилище

След това трябва да добавим Docker хранилище към вашата система. Изтеглете и добавете GPG ключа на Docker:

```bash
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \
sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
```

Това удостоверява, че пакетите, които ще инсталирате, идват от надежден източник. След това добавете Docker хранилището към източниците на APT:

```bash
echo \
  "deb [arch=$(dpkg --print-architecture) \
  signed-by=/etc/apt/keyrings/docker.gpg] \
  https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

### Стъпка 4: Актуализиране на пакетите и инсталиране на Docker

Изпълнете следната команда, за да актуализирате източниците и инсталирате Docker:

```bash
sudo apt update
sudo apt install docker-ce
```

- docker-ce означава Docker Community Edition (обществени издания на Docker).
### Стъпка 5: Проверка на инсталацията

След като инсталацията завърши, проверете дали Docker работи, като изпълните:

```bash
sudo systemctl status docker
```

Трябва да видите изход със статус active (running), което означава, че Docker работи правилно.

## Инсталиране на Docker на Windows

### Стъпка 1: Включване на виртуализация

При Windows се използва виртуализация, за да подкарва своят Docker Engine. Затова трябва да влезете в BIOS менюто я включите, ако вече не е. [Инструкции как да влезем в BIOS на Thinkpad](https://support.lenovo.com/lt/lt/solutions/ht500006-how-to-enable-virtualization-technology-on-lenovo-computers).

### Стъпка 2: Инсталиране на WSL

Docker при Windows може да използва различни технологии за виртуализация, но препоръчаната е WSL. За да я инсталирате, влезте в терминала и напишете:

```bash
wsl --install
```
### Стъпка 3: Инсталиране на Docker Desktop

При Windows най-лесният начин да подкараме Docker е чрез Docker Desktop. Това е приложение, което ни предоставя лесен начин да наблюдаваме и управляваме нашите образи и контейнери, но също така и подкарва инициализира нашият Docker Engine. Docker Desktop също така включва `docker` CLI командата, която ни позволява да работим с Docker от терминала. [Страница за сваляне на Docker Desktop.](https://docs.docker.com/desktop/setup/install/windows-install/)

## Инсталиране на Docker на MacOS

Ддз, ето [линк с инструкции](https://docs.docker.com/desktop/setup/install/mac-install/).

## Стартиране на първия контейнер

Сега, когато Docker е инсталиран, нека стартираме първия си контейнер, за да се уверим, че всичко работи правилно.

```bash
sudo docker run hello-world
```

- `docker run` - Създава и стартира нов контейнер от даден образ.
- `hello-world` - Това е малък тестов образ, който се използва за проверка на инсталацията на Docker.

Ако всичко е наред, ще видите съобщение от Docker, което потвърждава, че контейнерът е стартиран успешно.

## Създаване на уеб сървър с Nginx

Nginx е популярен уеб сървър и прокси сървър. Ще създадем контейнер с Nginx, за да демонстрираме как Docker работи с уеб сървъри.

```bash
sudo docker run -d -p 8080:80 nginx
```

-  `-d`: Стартира контейнера в „демонски режим“, което означава, че ще работи на заден
план.
- `-p 8080:80`: Това пренасочва порт 8080 на вашия хост към порт 80 в контейнера (порта, на който Nginx слуша).
-  `nginx`: Това е името на образа, който използваме. Docker автоматично ще изтегли последната версия на Nginx от Docker Hub.

След като контейнерът бъде стартиран, отворете браузъра и посетете http://localhost:8080. Ще видите стандартната страница на Nginx, която означава, че уеб сървърът работи правилно.

## Преглед на активните контейнери

След като стартираме няколко контейнера, може да искаме да видим кои контейнери са активни.

```bash
sudo docker ps
```

Тази команда ще покаже списък на активните контейнери, като ще включва следната
информация:
- **CONTAINER ID:** Идентификатор на контейнера.
- **IMAGE:** Образът, от който е създаден контейнера.
- **COMMAND:** Командата, която се изпълнява вътре в контейнера.
- **CREATED:** Кога е създаден контейнера.
- **STATUS:** Статус на контейнера (напр. „Up 2 minutes“).
- **PORTS:** Пренасочени портове между хоста и контейнера.
- **NAMES:** Името на контейнера.

## Създаване на персонализиран контейнер с Python приложение

Сега ще създадем персонализиран Docker контейнер, който съдържа Python приложение. Ще използваме Python и Flask, за да създадем малко уеб приложение.

### Стъпка 1. Създайте проектна директория

Първо създайте директория за вашето приложение:

```bash
mkdir python-app
cd python-app
```

### Стъпка 2: Създайте Dockerfile

Създайте файл на име Dockerfile в директорията:

```dockerfile
# Използваме официалния образ на Python 3.8
FROM python:3.8

# Задаваме работната директория в контейнера
WORKDIR /app

# Копираме всички локални файлове в контейнера
COPY . /app

# Инсталираме зависимостите (в случая Flask)
RUN pip install -r requirements.txt

# Задаваме командата за стартиране на приложението
CMD ["python", "app.py"]
```

### Стъпка 3: Създайте файл requirements.txt

Този файл ще съдържа необходимите Python библиотеки. Създайте файл requirements.txt с едно съдържание:

```txt
flask
```

### Стъпка 4: Създайте Python приложение

Създайте файл app.py, който ще съдържа минимално Flask приложение:

```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello():
    return 'Hello from Flask inside Docker!'

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```

### Стъпка 5: Създайте Docker образ

Изпълнете следната команда в директорията на проекта, за да изградите образа:

```bash
sudo docker build -t python-app .
```

### Стъпка 6: Стартирайте контейнера

След като изградите образа, стартирайте контейнера с командата:

```bash
sudo docker run -d -p 5000:5000 python-app
```

Вашето приложение ще бъде достъпно на адрес http://localhost:5000.

## Деинсталиране на Docker

Ако искате да премахнете Docker от системата, следвайте тези стъпки.

### Стъпка 1: Спиране на Docker

```bash
sudo systemctl stop docker
```

### Стъпка 2: Деинсталиране на Docker

```bash
sudo apt remove docker docker-engine docker.io containerd runc 
```

### Стъпка 3: Почистване на остатъчни файлове

```bash
sudo rm -rf /var/lib/docker
```

### Стъпка 4: Автоматично премахване на неизползвани пакети

```bash
sudo apt autoremove
```

## Заключение

Този урок покрива основните стъпки за работа с Docker: инсталиране, създаване на
контейнери, стартиране на приложения и създаване на персонализирани Dockerfile-и. Docker е
изключително полезен инструмент за разработчиците и системните администратори, който
позволява лесно и бързо стартиране на приложения в изолирани среди.